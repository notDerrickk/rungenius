<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="'RunGenius - Programme ' + ${programme.title}">RunGenius - Programme</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="alternate icon" href="/favicon.ico">

    <style>
        :root {
            --bg: linear-gradient(135deg,#e6f0ff 0%, #f7f9fb 100%);
            --card: #ffffff;
            --primary: #2b8aef;
            --accent: #ff6b6b;
            --muted: #6b7280;
            --green: #2ecc71;
        }
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family: Inter, Arial, Helvetica, sans-serif; background:var(--bg); color:#111; padding:20px}
        .container{max-width:1100px;margin:0 auto}
        header{background:linear-gradient(135deg,var(--primary),#764ba2); color:white;padding:26px;border-radius:12px;box-shadow:0 10px 30px rgba(15,23,42,0.18)}
        header h1{font-size:22px;margin-bottom:6px}
        header p{opacity:0.9;margin-top:4px}
        .meta{margin-top:12px;display:flex;flex-wrap:wrap;gap:8px}
        .chip{background:rgba(255,255,255,0.12);padding:8px 12px;border-radius:999px;font-weight:600}
        .card{background:var(--card);border-radius:12px;padding:18px;margin-top:18px;box-shadow:0 6px 18px rgba(20,30,60,0.06)}
        .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px}
        .week{border-left:6px solid var(--primary);padding:14px;margin-bottom:14px;border-radius:10px;background:#fff}
        .week.recup{border-left-color:var(--green);background:linear-gradient(180deg,#f1fff4,#fffef9)}
        .seance{display:flex;justify-content:space-between;background:#fbfdff;padding:12px;border-radius:8px;margin-bottom:8px;align-items:flex-start;gap:12px}
        .seance .left{flex:1;max-width:none}
        .seance .right{text-align:right;white-space:nowrap;display:flex;flex-direction:column;gap:6px;justify-content:center}
        .type{font-weight:700;color:#174ea6}
        .allure{background:linear-gradient(90deg,var(--primary),#764ba2);color:white;padding:6px 10px;border-radius:999px;font-weight:700;font-size:12px;display:inline-block}
        .distance{font-weight:700;font-size:14px;color:var(--primary)}
        .week-total{border-top:2px solid var(--primary);padding-top:12px;margin-top:12px;text-align:right;font-weight:700;font-size:14px;color:#111}
        .week-total .label{color:var(--muted);font-size:12px}
        .footer{margin-top:26px;text-align:center;color:var(--muted);font-size:13px}
        .btn-print{display:block;margin:12px auto;border-radius:24px;padding:10px 16px;border:none;background:linear-gradient(90deg,var(--primary),#764ba2);color:white;cursor:pointer}
        .btn-download{display:inline-block;margin:12px auto;border-radius:24px;padding:10px 16px;border:none;background:linear-gradient(90deg,#2ecc71,#27ae60);color:white;cursor:pointer;text-decoration:none}
        .actions{display:flex;gap:10px;justify-content:center;flex-wrap:wrap}
        @media(max-width:760px){.seance{flex-direction:column;gap:6px}.seance .right{text-align:left}}
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèÉ RunGenius ‚Äî Programme <span th:text="${programme.title}"></span></h1>
            <p>Progression douce ‚Ä¢ Semaines de repos toutes les 5 semaines</p>
            <div class="meta">
                <div class="chip">Niveau: <span th:text="${profil.niveau}"></span></div>
                <div class="chip">Sorties / semaine: <span th:text="${profil.sortiesParSemaine}"></span></div>
                <div class="chip">VMA: <span th:text="${profil.vma} + ' km/h'"></span></div>
                <div class="chip">G√©n√©r√©: <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></span></div>
            </div>
        </header>

        <div class="card">
            <div style="display:flex;justify-content:space-between;align-items:center">
                <div>
                    <strong>Profil</strong><br>
                    <span style="color:var(--muted)"><span th:text="${profil.niveau}"></span> ‚Äî <span th:text="${profil.sortiesParSemaine}"></span> sorties / semaine</span>
                </div>
                <div style="text-align:right">
                    <div style="font-weight:800;font-size:18px" th:text="${#numbers.formatDecimal(totalKm, 1, 1)} + ' km'"></div>
                    <div style="color:var(--muted);font-size:13px">Kilom√©trage estim√© total</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h3>Zones d'allure</h3>
            <div class="grid" style="margin-top:10px">
                <div class="card" style="text-align:center;padding:12px;border-radius:12px;background:#4caf50;">
                    <div style="font-size:12px;color:rgba(255,255,255,0.9)">Endurance (EF)</div>
                    <div style="font-weight:800;margin-top:8px;color:#ffffff" th:text="${allures[0]}"></div>
                </div>
                <div class="card" style="text-align:center;padding:12px;border-radius:12px;background:#ffc107;">
                    <div style="font-size:12px;color:rgba(255,255,255,0.9)">Allure sp√©cifique (<span th:text="${distanceLabel}"></span> km)</div>
                    <div style="font-weight:800;margin-top:8px;color:#ffffff" th:text="${allures[1]}"></div>
                </div>
                <div class="card" style="text-align:center;padding:12px;border-radius:12px;background:#ff9800;">
                    <div style="font-size:12px;color:rgba(255,255,255,0.9)">Seuil</div>
                    <div style="font-weight:800;margin-top:8px;color:#ffffff" th:text="${allures[2]}"></div>
                </div>
                <div class="card" style="text-align:center;padding:12px;border-radius:12px;background:#f44336;">
                    <div style="font-size:12px;color:rgba(255,255,255,0.9)">VMA (100%)</div>
                    <div style="font-weight:800;margin-top:8px;color:#ffffff" th:text="${allures[3]}"></div>
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="btn-print no-print" onclick="window.print()">üñ®Ô∏è Imprimer / Sauvegarder en PDF</button>
            <form action="/download" method="post" target="_blank" style="display:inline">
                <input type="hidden" name="raceType" th:value="${raceType}">
                <input type="hidden" name="niveau" th:value="${profil.niveau}">
                <input type="hidden" name="sorties" th:value="${profil.sortiesParSemaine}">
                <input type="hidden" name="vma" th:value="${profil.vma}">
                <input type="hidden" name="objectif" th:value="${objectif}">
                <input type="hidden" name="raceDate" th:value="${raceDate}">
                <button type="submit" class="btn-download">‚¨á T√©l√©charger HTML</button>
            </form>
            <a href="/" class="btn-print" style="text-decoration:none">üîÑ Nouveau</a>
        </div>

        <div style="margin-top:20px">
            <h2 style="text-align:center">Planning d√©taill√©</h2>

            <div th:each="semaine, stat : ${programme.semaines}"
                 th:with="numeroSemaine=${stat.index + 1}, isRecup=${numeroSemaine % 5 == 0}"
                 th:class="'week card ' + (${isRecup} ? 'recup' : '')">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px">
                    <div style="font-size:16px;font-weight:700">
                        Semaine <span th:text="${numeroSemaine}"></span>
                        <span th:if="${isRecup}"> ‚Äî R√âCUP</span>
                    </div>
                    <div style="color:var(--muted)">S√©ances: <span th:text="${semaine.length}"></span></div>
                </div>

                <div th:each="seance, seanceStat : ${semaine}" class="seance">
                    <div class="left">
                        <div class="type">
                            S√©ance <span th:text="${seanceNumbers[stat.index][seanceStat.index]}"></span> - 
                            <span th:text="${seance.nom}"></span>
                        </div>
                        <div style="color:#374151;margin-top:6px;font-size:14px; white-space:pre-line;" th:text="${seance.getDescription(profil)}"></div>                    </div>
                    <div class="right">
                        <div class="allure" th:text="${profil.getAllureFormatee(seance.pourcentageVMA)}"></div>
                        <div class="distance" th:text="${#numbers.formatDecimal(seance.getDistanceKm(profil), 1, 2)} + ' km'"></div>
                    </div>
                </div>

                <div class="week-total">
                    <div class="label">TOTAL SEMAINE</div>
                    <div th:text="${#numbers.formatDecimal(weekTotals[stat.index], 1, 2)} + ' km'"></div>
                </div>
            </div>
        </div>

        <div class="footer">
            G√©n√©r√© par RunGenius ‚Äî <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy')}"></span>
        </div>
    </div>
</body>
</html>