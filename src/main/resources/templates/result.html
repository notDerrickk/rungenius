<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title th:text="'RunGenius ‚Äî ' + ${programme.title}">RunGenius ‚Äî Programme</title>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <link rel="alternate icon" href="/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/app.css}">
</head>

<body>
<div class="rg-topbar">
    <div class="container py-3">
        <div class="d-flex align-items-center justify-content-between gap-2">
            <a class="rg-brand" href="/">
                <img src="/logo.png" alt="RunGenius" class="rg-logo">
            </a>
            <!-- Menu desktop -->
            <div class="d-none d-sm-flex align-items-center gap-2 rg-menu-desktop">
                <button class="rg-btn" type="button" data-theme-toggle aria-pressed="false">Clair</button>
                <a class="rg-btn" href="/dashboard">Mes programmes</a>
                <a class="rg-btn" href="/editor">√âditeur</a>
            </div>
            <!-- Hamburger pour mobile -->
            <button class="rg-hamburger d-inline-flex d-sm-none" aria-label="Ouvrir le menu" aria-controls="rg-mobile-menu" aria-expanded="false">
                <span class="rg-hamburger-bar"></span>
                <span class="rg-hamburger-bar"></span>
                <span class="rg-hamburger-bar"></span>
            </button>
        </div>
    </div>
    <!-- Menu mobile masqu√© par d√©faut -->
    <nav id="rg-mobile-menu" class="rg-mobile-menu" aria-hidden="true">
        <button class="rg-mobile-menu-close" aria-label="Fermer le menu">&times;</button>
        <a class="rg-btn" href="/dashboard">Mes programmes</a>
        <a class="rg-btn" href="/editor">√âditeur</a>
        <button class="rg-btn" type="button" data-theme-toggle aria-pressed="false" title="Basculer th√®me">Clair</button>
    </nav>
</div>

<div class="container my-4" style="padding-bottom: 90px;">
    <div class="rg-card mb-3">
        <div class="rg-card-inner">
            <div class="rg-section-title" style="font-size: 1.35rem;" th:text="${programme.title}">Programme</div>
            <div class="small-muted mt-1">Progression douce ‚Ä¢ Semaines de repos toutes les 5 semaines</div>

            <div class="d-flex flex-wrap gap-2 mt-3">
                <span class="rg-chip">Niveau: <span th:text="${profil.niveau}"></span></span>
                <span class="rg-chip">Sorties/sem: <span th:text="${profil.sortiesParSemaine}"></span></span>
                <span class="rg-chip">VMA: <span th:text="${profil.vma}"></span> km/h</span>
                <span class="rg-chip">G√©n√©r√©: <span th:text="${#temporals.format(#temporals.createNow(), 'dd/MM/yyyy HH:mm')}"></span></span>
            </div>
        </div>
    </div>

    <div class="rg-card mb-3">
        <div class="rg-card-inner">
            <div class="d-flex justify-content-between align-items-center gap-2">
                <div>
                    <div class="rg-section-title">Zones d'allure</div>
                </div>
                <div class="small-muted" th:text="${#numbers.formatDecimal(totalKm, 1, 1)} + ' km total'">‚Äî</div>
            </div>

            <div class="rg-divider"></div>

            <div class="rg-pace-grid">
                <div class="rg-pace-card rg-pace-ef">
                    <div class="label">Endurance (EF)</div>
                    <div class="value" th:text="${allures[0]}">‚Äî</div>
                </div>
                <div class="rg-pace-card rg-pace-as">
                    <div class="label">Allure sp√©cifique</div>
                    <div class="value" th:text="${allures[1]}">‚Äî</div>
                </div>
                <div class="rg-pace-card rg-pace-seuil">
                    <div class="label">Seuil</div>
                    <div class="value" th:text="${allures[2]}">‚Äî</div>
                </div>
                <div class="rg-pace-card rg-pace-vma">
                    <div class="label">VMA</div>
                    <div class="value" th:text="${allures[3]}">‚Äî</div>
                </div>
            </div>
        </div>
    </div>

    <div class="rg-card">
        <div class="rg-card-inner">
            <div class="rg-section-title">Planning d√©taill√©</div>
            <div class="rg-divider"></div>

              <div th:each="semaine, stat : ${programme.semaines}"
                  th:with="numeroSemaine=${stat.index + 1}, isRecup=${numeroSemaine % 5 == 0}"
                  class="rg-week" th:classappend="${isRecup} ? ' rg-week-recup' : ''">

                <div class="rg-week-head">
                    <div class="d-flex align-items-center gap-2 flex-wrap">
                        <div class="rg-week-title">
                            Semaine <span th:text="${numeroSemaine}"></span>
                        </div>
                        <span th:if="${isRecup}" class="rg-chip">R√©cup</span>
                        <span class="rg-chip">S√©ances: <span th:text="${semaine.length}"></span></span>
                    </div>

                    <div class="small-muted">
                        Total: <span th:text="${#numbers.formatDecimal(weekTotals[stat.index], 1, 2)} + ' km'"></span>
                    </div>
                </div>

                <div class="rg-week-body">
                    <div th:each="seance, seanceStat : ${semaine}" class="rg-session"
                         th:attr="data-week=${stat.index + 1}, data-session=${seanceStat.index}">
                        <div class="d-flex justify-content-between align-items-start gap-2">
                            <div style="flex:1;">
                                <p class="rg-session-title">
                                    S√©ance <span th:text="${seanceNumbers[stat.index][seanceStat.index]}"></span> ‚Äî
                                    <span class="rg-session-nom" th:text="${seance.nom}"></span>
                                    <span class="rg-session-adjusted" style="display:none; margin-left:8px; font-size:.78rem; font-weight:800; padding:.25rem .5rem; border-radius:999px; background:rgba(255,255,255,.08); border:1px solid var(--stroke);">
                                        Ajust√©e
                                    </span>
                                </p>
                                <div class="rg-session-sub">
                                    <div><strong>Type:</strong> <span class="rg-session-type" th:text="${seance.type}"></span></div>
                                    <div><strong>√âchauffement:</strong> <span class="rg-session-echauffement" th:text="${seance.dureeEchauffement}"></span> min</div>
                                    <div><strong>Corps:</strong> <span class="rg-session-corps" th:text="${seance.corps}"></span></div>
                                    <div><strong>Retour au calme:</strong> <span class="rg-session-cooldown" th:text="${seance.dureeCooldown}"></span> min</div>
                                </div>
                            </div>

                            <div class="text-end">
                                <div class="rg-chip rg-allure-chip" th:text="${profil.getAllureFormatee(seance.pourcentageVMA)}">‚Äî</div>
                                  <div class="mt-2 rg-session-distance" style="font-weight:900;"
                                      th:text="${#numbers.formatDecimal(seance.getDistanceKm(profil), 1, 2)} + ' km'">‚Äî</div>

                                <form th:action="@{/fit/export-single}" method="post" style="margin-top:10px">
                                    <input type="hidden" name="nom" th:value="${seance.nom}">
                                    <input type="hidden" class="rg-hidden-type" name="type" th:value="${seance.type}">
                                    <input type="hidden" class="rg-hidden-echauffement" name="echauffement" th:value="${seance.dureeEchauffement}">
                                    <input type="hidden" class="rg-hidden-corps" name="corps" th:value="${seance.corps}">
                                    <input type="hidden" class="rg-hidden-cooldown" name="cooldown" th:value="${seance.dureeCooldown}">
                                    <input type="hidden" class="rg-hidden-allurePct" name="allurePct" th:value="${seance.pourcentageVMA}">
                                    <input type="hidden" name="vma" th:value="${profil.vma}">
                                    <button type="submit" class="rg-btn">Exporter .fit</button>
                                </form>
                                
                                <button type="button" class="rg-btn rg-edit-session-btn" style="margin-top:10px;"
                                    th:attr="data-week=${stat.index + 1}, 
                                             data-session=${seanceStat.index},
                                             data-nom=${seance.nom},
                                             data-type=${seance.type},
                                             data-echauffement=${seance.dureeEchauffement},
                                             data-corps=${seance.corps},
                                             data-cooldown=${seance.dureeCooldown},
                                             data-allurepct=${seance.pourcentageVMA}"
                                    onclick="openEditSeanceModal(this)">
                                    √âditer
                                </button>
                                
                                    <button type="button" class="rg-btn rg-btn-primary rg-btn-feedback" style="margin-top:10px;"
                                        th:attr="data-week=${stat.index + 1}, data-session=${seanceStat.index}, data-session-type=${seance.type}"
                                        th:onclick="'openFeedbackModal(' + ${numeroSemaine} + ',' + ${seanceStat.index} + ')'">
                                        S√©ance termin√©e ‚úì
                                    </button>
                            </div>
                        </div>
                    </div>

                    <div class="d-flex justify-content-between align-items-center pt-2"
                         style="border-top:1px solid var(--stroke); margin-top:.85rem;">
                        <div class="small-muted">TOTAL SEMAINE</div>
                        <div style="font-weight:950;"
                             th:text="${#numbers.formatDecimal(weekTotals[stat.index], 1, 2)} + ' km'"></div>
                    </div>
                </div>
            </div>

            <div class="small-muted text-center mt-2">G√©n√©r√© par RunGenius</div>
            <div class="small-muted text-center mt-1">¬© 2025 Rod√©ric NEVEU</div>
        </div>
    </div>
</div>

<div class="rg-actionbar">
    <div class="container">
        <div class="wrap">
            <button class="rg-btn rg-btn-primary" onclick="window.print()">Imprimer / PDF</button>

            <form action="/download" method="post" target="_blank" style="display:inline">
                <input type="hidden" name="raceType" th:value="${raceType}">
                <input type="hidden" name="niveau" th:value="${profil.niveau}">
                <input type="hidden" name="sorties" th:value="${profil.sortiesParSemaine}">
                <input type="hidden" name="vma" th:value="${profil.vma}">
                <input type="hidden" name="objectif" th:value="${objectif}">
                <input type="hidden" name="raceDate" th:value="${raceDate}">
                <button type="submit" class="rg-btn">T√©l√©charger HTML</button>
            </form>

            <form action="/fit/export-all" method="post" style="display:inline">
                <input type="hidden" name="raceType" th:value="${raceType}">
                <input type="hidden" name="niveau" th:value="${profil.niveau}">
                <input type="hidden" name="sorties" th:value="${profil.sortiesParSemaine}">
                <input type="hidden" name="vma" th:value="${profil.vma}">
                <input type="hidden" name="objectif" th:value="${objectif}">
                <input type="hidden" name="raceDate" th:value="${raceDate}">
                <button type="submit" class="rg-btn">Exporter pour montre Garmin</button>
            </form>

            <a href="/" class="rg-btn">Nouveau</a>
        </div>
    </div>
</div>

<!-- Modal d'√©dition de s√©ance -->
<div id="editSeanceModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:10000; justify-content:center; align-items:center; padding: 1rem;">
    <div style="background:var(--bg); border-radius:12px; padding:1.5rem; max-width:600px; width:100%; max-height:90vh; overflow-y:auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
        <h3 style="margin-top:0; margin-bottom:1.25rem; color:var(--text); font-size: clamp(1.1rem, 4vw, 1.3rem);">√âditer la s√©ance</h3>
        
        <form id="editSeanceForm" style="display:flex; flex-direction:column; gap:1rem;">
            <div>
                <label style="display:block; margin-bottom:0.5rem; font-weight:600; color:var(--text);">Nom de la s√©ance :</label>
                <input type="text" id="editNom" name="nom" class="form-control" required>
            </div>
            
            <div>
                <label style="display:block; margin-bottom:0.5rem; font-weight:600; color:var(--text);">Type :</label>
                <input type="text" id="editType" name="type" class="form-control" required>
            </div>
            
            <div>
                <label style="display:block; margin-bottom:0.5rem; font-weight:600; color:var(--text);">√âchauffement (min) :</label>
                <input type="number" id="editEchauffement" name="echauffement" class="form-control" min="0" required>
            </div>
            
            <div>
                <label style="display:block; margin-bottom:0.5rem; font-weight:600; color:var(--text);">Corps de s√©ance :</label>
                <input type="text" id="editCorps" name="corps" class="form-control" required>
            </div>
            
            <div>
                <label style="display:block; margin-bottom:0.5rem; font-weight:600; color:var(--text);">Retour au calme (min) :</label>
                <input type="number" id="editCooldown" name="cooldown" class="form-control" min="0" required>
            </div>
            
            <div>
                <label style="display:block; margin-bottom:0.5rem; font-weight:600; color:var(--text);">Allure (% VMA) :</label>
                <input type="number" id="editAllurePct" name="allurePct" class="form-control" min="0" max="2" step="0.01" required>
            </div>
            
            <input type="hidden" id="editWeek" name="week">
            <input type="hidden" id="editSessionIndex" name="sessionIndex">
            
            <div style="display:flex; gap:0.75rem; margin-top:1rem;">
                <button type="submit" class="rg-btn rg-btn-primary" style="flex:1;">Sauvegarder</button>
                <button type="button" id="cancelEditSeance" class="rg-btn" style="flex:1;">Annuler</button>
            </div>
        </form>
    </div>
</div>

<div id="feedbackModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999; justify-content:center; align-items:center; padding: 1rem;">
    <div style="background:var(--bg); border-radius:12px; padding:1.5rem; max-width:500px; width:100%; max-height:90vh; overflow-y:auto; box-shadow: 0 10px 40px rgba(0,0,0,0.3);">
        <h3 style="margin-top:0; margin-bottom:1.25rem; color:var(--text); font-size: clamp(1.1rem, 4vw, 1.3rem);">Comment s'est pass√©e votre s√©ance ?</h3>
        
        <div id="feedbackStandard" style="margin-bottom:1.25rem;">
            <label style="display:block; margin-bottom:0.75rem; font-weight:600; color:var(--text); font-size: 0.95rem;">Ressenti :</label>
            <div style="display:flex; flex-direction:column; gap:0.75rem;">
                <label style="cursor:pointer; padding:0.9rem 1rem; border:2px solid var(--stroke); border-radius:10px; display:flex; align-items:center; transition: all 0.2s; font-size: 0.9rem;">
                    <input type="radio" name="feeling" value="tooEasy" style="margin-right:0.75rem; min-width: 18px; min-height: 18px;">
                    <span>üòä Tr√®s facile - J'aurais pu faire plus</span>
                </label>
                <label style="cursor:pointer; padding:0.9rem 1rem; border:2px solid var(--stroke); border-radius:10px; display:flex; align-items:center; transition: all 0.2s; font-size: 0.9rem;">
                    <input type="radio" name="feeling" value="doable" checked style="margin-right:0.75rem; min-width: 18px; min-height: 18px;">
                    <span>üëç Faisable - Niveau adapt√©</span>
                </label>
                <label style="cursor:pointer; padding:0.9rem 1rem; border:2px solid var(--stroke); border-radius:10px; display:flex; align-items:center; transition: all 0.2s; font-size: 0.9rem;">
                    <input type="radio" name="feeling" value="tooHard" style="margin-right:0.75rem; min-width: 18px; min-height: 18px;">
                    <span>üòì Trop dur - J'ai eu du mal √† finir</span>
                </label>
            </div>
        </div>
        
        <div id="feedbackCustom" style="display:none; margin-bottom:1.25rem;">
            <div style="display:block; margin-bottom:0.75rem; font-weight:600; color:var(--text); font-size: 1.1rem; text-align:center;">S√©ance personnalis√©e termin√©e</div>
            <div style="margin-top:1.25rem; display:flex; flex-direction:column; align-items:center; gap:0.75rem;">
                <label style="cursor:pointer; padding:0.9rem 1rem; border:2px solid #ef4444; border-radius:10px; display:flex; align-items:center; background:rgba(239,68,68,0.05); font-size: 0.98rem;">
                    <input type="checkbox" id="customHasPain" style="margin-right:0.75rem; min-width: 18px; min-height: 18px;">
                    <span style="font-weight:600;">‚ö†Ô∏è Douleur signal√©e (remplace la prochaine s√©ance par 20min EF)</span>
                </label>
            </div>
        </div>
        
        <div id="painCheckbox" style="margin-bottom:1.5rem;">
            <label style="cursor:pointer; padding:0.9rem 1rem; border:2px solid var(--stroke); border-radius:10px; display:flex; align-items:center; background:var(--card-bg); font-size: 0.9rem;">
                <input type="checkbox" id="hasPain" style="margin-right:0.75rem; min-width: 18px; min-height: 18px;">
                <span style="font-weight:600;">‚ö†Ô∏è Je ressens une douleur</span>
            </label>
            <small style="display:block; margin-top:0.5rem; color:var(--muted); padding-left:0.75rem; font-size: 0.85rem; line-height: 1.4;">
                Si coch√©, la prochaine s√©ance sera remplac√©e par une s√©ance de r√©cup√©ration
            </small>
        </div>
        
        <div style="display:flex; flex-direction: column; gap:0.75rem;">
            <button id="submitFeedback" class="rg-btn rg-btn-primary" style="width: 100%;">Valider</button>
            <button id="cancelFeedback" class="rg-btn" style="width: 100%;">Annuler</button>
        </div>
    </div>
</div>

<script th:inline="javascript">
    var raceType = '';
    try {
        raceType = /*[[${raceType}]]*/ '';
    } catch(e) {
        raceType = document.querySelector('input[name="raceType"]')?.value || '';
    }
    window.isCustomProgram = raceType === 'custom';
</script>

<script th:src="@{/app.js}"></script>

<script>
(function() {
    const modal = document.getElementById('feedbackModal');
    const submitBtn = document.getElementById('submitFeedback');
    const cancelBtn = document.getElementById('cancelFeedback');
    
    const feedbackStandard = document.getElementById('feedbackStandard');
    const feedbackCustom = document.getElementById('feedbackCustom');
    const painCheckbox = document.getElementById('painCheckbox');
    
    let currentWeek, currentSessionIndex;
    
    // Configurer l'affichage selon le type de programme
    if (window.isCustomProgram) {
        feedbackStandard.style.display = 'none';
        painCheckbox.style.display = 'none';
        feedbackCustom.style.display = 'block';
    } else {
        feedbackStandard.style.display = 'block';
        painCheckbox.style.display = 'block';
        feedbackCustom.style.display = 'none';
    }
    
    window.openFeedbackModal = function(week, sessionIndex) {
        currentWeek = week;
        currentSessionIndex = sessionIndex;
        modal.style.display = 'flex';
    };
    
    cancelBtn.addEventListener('click', () => {
        modal.style.display = 'none';
    });
    
    submitBtn.addEventListener('click', async () => {
        let hasPain = false;
        let feeling = 'doable';
        
        if (window.isCustomProgram) {
            hasPain = document.getElementById('customHasPain')?.checked || false;
        } else {
            const selectedFeeling = document.querySelector('input[name="feeling"]:checked');
            feeling = selectedFeeling ? selectedFeeling.value : 'doable';
            hasPain = document.getElementById('hasPain').checked;
        }
        
        const payload = {
            week: currentWeek,
            sessionIndex: currentSessionIndex,
            feeling: feeling,
            hasPain: hasPain
        };
        
        try {
            const response = await fetch('/feedback', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            const data = await response.json();
            
            if (data.ok) {
                markSessionAsCompleted(currentWeek, currentSessionIndex);
                
                alert(data.message || 'Feedback enregistr√© - S√©ance marqu√©e comme termin√©e !');
                if (data.updatedWeek && data.updatedSessionIndex !== undefined) {
                    location.reload();
                } else {
                    modal.style.display = 'none';
                    location.reload();
                }
            } else {
                alert(data.message || 'Erreur lors du feedback');
            }
            
            modal.style.display = 'none';
        } catch (err) {
            alert('Erreur r√©seau: ' + err.message);
        }
    });
    
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.style.display = 'none';
        }
    });
    
    // Fonctions pour g√©rer les s√©ances termin√©es
    function getStorageKey() {
        const raceTypeEl = document.querySelector('input[name="raceType"]');
        const niveauEl = document.querySelector('input[name="niveau"]');
        const raceType = raceTypeEl ? raceTypeEl.value : 'unknown';
        const niveau = niveauEl ? niveauEl.value : 'unknown';
        return `rg-completed-sessions-${raceType}-${niveau}`;
    }
    
    function markSessionAsCompleted(week, sessionIndex) {
        const key = getStorageKey();
        let completed = JSON.parse(sessionStorage.getItem(key) || '{}');
        if (!completed[week]) completed[week] = [];
        if (!completed[week].includes(sessionIndex)) {
            completed[week].push(sessionIndex);
        }
        sessionStorage.setItem(key, JSON.stringify(completed));
        
        applyCompletedStyle(week, sessionIndex);
    }
    
    function applyCompletedStyle(week, sessionIndex) {
        const sessionEl = document.querySelector(`.rg-session[data-week="${week}"][data-session="${sessionIndex}"]`);
        if (sessionEl) {
            sessionEl.classList.add('rg-session-completed');

            const rightCol = sessionEl.querySelector('.text-end');
            if (rightCol) {
                if (!rightCol.querySelector('.rg-session-completed-badge')) {
                    const badge = document.createElement('span');
                    badge.className = 'rg-session-completed-badge';
                    badge.textContent = '‚úì';

                    const chip = rightCol.querySelector('.rg-chip');
                    if (chip) rightCol.insertBefore(badge, chip);
                    else rightCol.prepend(badge);
                }
            }

            const feedbackBtn = sessionEl.querySelector('.rg-btn-feedback');
            if (feedbackBtn) {
                feedbackBtn.textContent = 'Effectu√©e ‚úì';
                feedbackBtn.style.opacity = '0.7';
            }
        }
    }
    
    function loadCompletedSessions() {
        const key = getStorageKey();
        const completed = JSON.parse(sessionStorage.getItem(key) || '{}');
        
        for (const week in completed) {
            for (const sessionIndex of completed[week]) {
                applyCompletedStyle(parseInt(week), sessionIndex);
            }
        }
    }
    
    window.markSessionAsCompleted = markSessionAsCompleted;
    
    loadCompletedSessions();
})();

// Gestion de l'√©dition de s√©ance
(function() {
    const editModal = document.getElementById('editSeanceModal');
    const editForm = document.getElementById('editSeanceForm');
    const cancelEditBtn = document.getElementById('cancelEditSeance');
    
    window.openEditSeanceModal = function(button) {
        const week = button.getAttribute('data-week');
        const sessionIndex = button.getAttribute('data-session');
        const nom = button.getAttribute('data-nom');
        const type = button.getAttribute('data-type');
        const echauffement = button.getAttribute('data-echauffement');
        const corps = button.getAttribute('data-corps');
        const cooldown = button.getAttribute('data-cooldown');
        const allurePct = button.getAttribute('data-allurepct');
        
        document.getElementById('editWeek').value = week;
        document.getElementById('editSessionIndex').value = sessionIndex;
        document.getElementById('editNom').value = nom;
        document.getElementById('editType').value = type;
        document.getElementById('editEchauffement').value = echauffement;
        document.getElementById('editCorps').value = corps;
        document.getElementById('editCooldown').value = cooldown;
        document.getElementById('editAllurePct').value = allurePct;
        
        editModal.style.display = 'flex';
    };
    
    cancelEditBtn.addEventListener('click', () => {
        editModal.style.display = 'none';
    });
    
    editModal.addEventListener('click', (e) => {
        if (e.target === editModal) {
            editModal.style.display = 'none';
        }
    });
    
    editForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const formData = new FormData(editForm);
        const payload = {
            week: parseInt(formData.get('week')),
            sessionIndex: parseInt(formData.get('sessionIndex')),
            nom: formData.get('nom'),
            type: formData.get('type'),
            echauffement: parseInt(formData.get('echauffement')),
            corps: formData.get('corps'),
            cooldown: parseInt(formData.get('cooldown')),
            allurePct: parseFloat(formData.get('allurePct'))
        };
        
        try {
            const response = await fetch('/seance/update', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            const data = await response.json();
            
            if (data.ok) {
                alert(data.message || 'S√©ance mise √† jour avec succ√®s !');
                editModal.style.display = 'none';
                location.reload();
            } else {
                alert(data.message || 'Erreur lors de la mise √† jour');
            }
        } catch (err) {
            alert('Erreur r√©seau: ' + err.message);
        }
    });
})();
</script>

</body>

</html>